<!DOCTYPE html><html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Organizador de Parciales ULTRA</title>
<style>
:root{--bg:#f4f6f8;--card:#fff;--text:#000;--accent:#6a5acd;--danger:#e53935;--warn:#f9a825}
body.dark{--bg:#0e0e14;--card:#1a1a25;--text:#fff}
body{font-family:Arial,sans-serif;background:var(--bg);color:var(--text);padding:20px}
h1{text-align:center}
.card{background:var(--card);padding:16px;border-radius:18px;margin-bottom:20px;box-shadow:0 12px 30px rgba(0,0,0,.08)}
input,button,select,textarea{padding:8px;margin:5px 0;width:100%;border-radius:10px;border:1px solid #ccc}
button{background:var(--accent);color:#fff;border:none}
button.secondary{background:#888}
button.danger{background:var(--danger)}
ul{list-style:none;padding:0}
li{margin:4px 0}
.done{text-decoration:line-through;color:gray}
.parcial{border:1px solid #ccc;border-radius:16px;padding:12px;margin-bottom:15px}
.progress{height:8px;background:#ddd;border-radius:10px;overflow:hidden}
.progress div{height:100%;background:var(--accent)}
.badge{display:inline-block;background:var(--accent);color:#fff;padding:2px 8px;border-radius:20px;font-size:12px}
.today{font-weight:bold}
.note{font-size:12px;opacity:.85}
.crisis{border:2px solid var(--danger)}
.warn{color:var(--warn);font-weight:bold}
</style>
</head>
<body>
<h1>üß† Organizador de Parciales ULTRA</h1><div class="card">
<button onclick="toggleDark()">üåô / ‚òÄÔ∏è Modo oscuro</button>
<p>üî• Racha: <span id="racha">0</span> d√≠as</p>
<p>üìä Productividad semanal: <span id="prod">0%</span></p>
</div><div class="card">
<h2>Nuevo parcial</h2>
<input id="nombreParcial" placeholder="Nombre del parcial" />
<input id="fechaParcial" type="date" />
<select id="pesoParcial">
<option value="1">Carga baja</option>
<option value="2">Carga media</option>
<option value="3">Carga alta</option>
</select>
<button onclick="crearParcial()">Crear parcial</button>
</div><div id="contenedorParciales"></div><script>
let parciales=JSON.parse(localStorage.getItem('parciales'))||[];
let dark=localStorage.getItem('dark')==='true';
let racha=Number(localStorage.getItem('racha')||0);
let ultimo=localStorage.getItem('ultimoDia');
let historial=JSON.parse(localStorage.getItem('historial'))||[];

if(dark)document.body.classList.add('dark');
document.getElementById('racha').innerText=racha;

function guardar(){localStorage.setItem('parciales',JSON.stringify(parciales));localStorage.setItem('dark',dark);localStorage.setItem('racha',racha);localStorage.setItem('ultimoDia',ultimo);localStorage.setItem('historial',JSON.stringify(historial))}
function toggleDark(){dark=!dark;document.body.classList.toggle('dark');guardar()}

function crearParcial(){if(!nombreParcial.value||!fechaParcial.value)return;parciales.push({nombre:nombreParcial.value,fecha:fechaParcial.value,peso:Number(pesoParcial.value),temas:[]});nombreParcial.value='';fechaParcial.value='';guardar();render()}

function agregarTema(p){const n=document.getElementById(`tema-${p}`).value;const pr=document.getElementById(`prio-${p}`).value;const dif=document.getElementById(`dif-${p}`).value;const nt=document.getElementById(`nota-${p}`).value;if(!n)return;parciales[p].temas.push({nombre:n,hecho:false,prioridad:pr,dificultad:dif,nota:nt});guardar();render()}

function toggleTema(p,t){parciales[p].temas[t].hecho=!parciales[p].temas[t].hecho;actualizarRacha();registrarActividad();guardar();render()}

function actualizarRacha(){const hoy=new Date().toDateString();if(ultimo!==hoy){racha++;ultimo=hoy}}

function registrarActividad(){const hoy=new Date().toISOString().slice(0,10);historial.push(hoy)}

function productividad(){if(historial.length===0)return 0;const ult7=[...new Set(historial)].slice(-7).length;return Math.round((ult7/7)*100)}

function dday(f){return Math.ceil((new Date(f)-new Date())/(1000*60*60*24))}
function progreso(p){if(!p.temas.length)return 0;return Math.round((p.temas.filter(t=>t.hecho).length/p.temas.length)*100)}

function scoreTema(t,peso){const prio={alta:3,media:2,baja:1}[t.prioridad];const dif={alta:3,media:2,baja:1}[t.dificultad];return prio*2+dif*2+peso}

function hoyToca(p){let pendientes=p.temas.filter(t=>!t.hecho);
pendientes.sort((a,b)=>scoreTema(b,p.peso)-scoreTema(a,p.peso));
const d=dday(p.fecha);if(d<=0)return[];const carga=Math.max(1,Math.ceil((pendientes.length*p.peso)/d));
return pendientes.slice(0,carga)}

function render(){document.getElementById('prod').innerText=productividad()+'%';contenedorParciales.innerHTML='';parciales.forEach((p,i)=>{
const prog=progreso(p);const hoy=hoyToca(p);const crisis=dday(p.fecha)<=3?'crisis':'';
const div=document.createElement('div');div.className='parcial '+crisis;
div.innerHTML=`<h3>${p.nombre} <span class='badge'>${dday(p.fecha)} d√≠as</span></h3>
<p class='warn'>Carga del parcial: ${p.peso}</p>
<div class='progress'><div style='width:${prog}%'></div></div>
<p>${prog}% completado</p>
<p class='today'>üìå Hoy estudiar: ${hoy.length?hoy.map(t=>t.nombre).join(', '):'Nada üéâ'}</p>
<input id='tema-${i}' placeholder='Tema'/>
<select id='prio-${i}'><option value='alta'>Prioridad alta</option><option value='media'>Prioridad media</option><option value='baja'>Prioridad baja</option></select>
<select id='dif-${i}'><option value='alta'>Dif√≠cil</option><option value='media'>Media</option><option value='baja'>F√°cil</option></select>
<textarea id='nota-${i}' placeholder='Nota'></textarea><button onclick='agregarTema(${i})'>Agregar tema</button>

<ul>${p.temas.map((t,j)=>`<li><input type='checkbox' ${t.hecho?'checked':''} onchange='toggleTema(${i},${j})'/> <span class='${t.hecho?'done':''}'>${t.nombre}</span> <span class='note'>[${t.prioridad}/${t.dificultad}] ${t.nota||''}</span></li>`).join('')}</ul>`;
contenedorParciales.appendChild(div)})}
render();
</script>
</body>
</html>
  
